<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“š Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ø£Ø¯Ù„Ø©</title>
<style>
body {
  font-family: "Cairo", Arial, sans-serif;
  margin: 0; padding: 0;
  background: #f5f7fa; color: #2c3e50; text-align: center;
}

header {
  background: #3498db; color: white; padding: 15px;
  font-size: 1.5em;
}

.container {
  padding: 20px; max-width: 900px; margin: auto;
}

.policy-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 10px 0;
  padding: 10px 15px;
  background: #9b59b6;
  color: white;
  border-radius: 6px;
}

.policy-item span {
  flex: 1; text-align: right; font-size: 1em;
}

.policy-item button {
  margin-left: 6px; padding: 6px 10px;
  font-size: 0.95em; border: none;
  border-radius: 4px; cursor: pointer;
  transition: 0.2s;
  background: #34495e; color: white;
}

.policy-item button:hover {
  background: #2c3e50;
}

.pdf-toolbar {
  display: flex; justify-content: center;
  gap: 10px; margin: 15px 0;
}

.pdf-toolbar button {
  background: #34495e; color: white; border: none;
  padding: 8px 12px; border-radius: 4px; cursor: pointer;
}

#pdfViewer {
  width: 100%; height: 70vh; border: none; display: none; margin-top: 10px;
}
</style>
</head>
<body>

<header>ğŸ“š Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ø£Ø¯Ù„Ø©</header>
<div class="container" id="policiesContainer"></div>

<div class="pdf-toolbar" id="pdfToolbar" style="display:none;">
  <button onclick="printPdf()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
  <button onclick="downloadPdf()">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„</button>
  <button onclick="closePdf()">âŒ Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<iframe id="pdfViewer"></iframe>

<script>
// âœ… Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª
const studentPolicies = [
  { title: "ğŸ“˜ Ø§Ù„Ù„Ø§Ø¦Ø­Ø© Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ©", filename: "Behaviour_Policy.pdf" },
  { title: "ğŸ“— Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø§Ø¬Ø±Ø§Ø¦ÙŠ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø­Ø¶ÙˆØ± ÙˆØºÙŠØ§Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø©", filename: "Attendance_Policy.pdf" },
  { title: "ğŸ“• Ø³ÙŠØ§Ø³Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…", filename: "Assessment_Policy.pdf" }
];

const staffPolicies = [
  { title: "ğŸ“˜ Ø§Ù„Ù…ÙŠØ«Ø§Ù‚ Ø§Ù„Ù…Ù‡Ù†ÙŠ ÙˆØ§Ù„Ø£Ø®Ù„Ø§Ù‚ÙŠ", filename: "Ethics_Charter_Policy.pdf" },
  { title: "ğŸ“— Ø§Ù„Ù„Ø§Ø¦Ø­Ø© Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ©", filename: "Behaviour_Policy.pdf" }
];

let currentPdfFile = null;

// ================================
// âœ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
// ================================
function loadPolicies(role) {
  const container = document.getElementById("policiesContainer");
  if (!container) return;
  container.innerHTML = "";

  let policies = role === "student" ? studentPolicies : staffPolicies;
  if (policies.length === 0) {
    container.innerHTML = "<p>âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙŠØ§Ø³Ø§Øª Ù…ØªØ§Ø­Ø©</p>";
    return;
  }

  policies.forEach(item => {
    const div = document.createElement("div");
    div.className = "policy-item";

    const span = document.createElement("span");
    span.textContent = item.title;

    const btnView = document.createElement("button");
    btnView.textContent = "ğŸ‘ï¸ Ø¹Ø±Ø¶";
    btnView.onclick = () => openPdfSmart(item.filename);

    const btnDownload = document.createElement("button");
    btnDownload.textContent = "â¬‡ï¸ ØªØ­Ù…ÙŠÙ„";
    btnDownload.onclick = () => downloadPdf();

    const btnPrint = document.createElement("button");
    btnPrint.textContent = "ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©";
    btnPrint.onclick = () => printPdf();

    div.appendChild(span);
    div.appendChild(btnView);
    div.appendChild(btnDownload);
    div.appendChild(btnPrint);

    container.appendChild(div);
  });
}

// ================================
// âœ… Ø¯ÙˆØ§Ù„ PDF
// ================================
function openPdfSmart(filename) {
  if (!filename) return alert("âŒ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù„Ù");
  currentPdfFile = filename;

  const viewerUrl = `/pdfjs/web/viewer.html?file=${encodeURIComponent("/pdfs/" + filename)}`;
  const pdfViewer = document.getElementById("pdfViewer");
  const pdfToolbar = document.getElementById("pdfToolbar");

  pdfViewer.src = viewerUrl;
  pdfViewer.style.display = "block";
  pdfToolbar.style.display = "flex";
  pdfViewer.scrollIntoView({ behavior: "smooth" });
}

function downloadPdf() {
  if (!currentPdfFile) return;
  const link = document.createElement("a");
  link.href = `/pdfs/${currentPdfFile}`;
  link.download = currentPdfFile;
  link.click();
}

function printPdf() {
  if (!currentPdfFile) return;
  const printWindow = window.open(
    `/pdfjs/web/viewer.html?file=${encodeURIComponent("/pdfs/" + currentPdfFile)}&print=true`,
    "_blank"
  );
  if (printWindow) printWindow.focus();
}

function closePdf() {
  document.getElementById("pdfViewer").style.display = "none";
  document.getElementById("pdfToolbar").style.display = "none";
  document.getElementById("pdfViewer").src = "";
}

// ================================
// âœ… Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
// ================================
document.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(window.location.search);
  const role = params.get("role") || sessionStorage.getItem("role");
  if (role) loadPolicies(role);
});
</script>

</body>
</html>
