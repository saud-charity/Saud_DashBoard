<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>📚 السياسات والأدلة</title>
<link rel="stylesheet" href="/css/style.css">
<style>
/* 🌐 الأساسيات */
body {
    font-family: "Cairo", Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: #f5f7fa;
    color: #2c3e50;
    text-align: center;
}
header {
    background: #3498db;
    color: white;
    padding: 15px;
}
h1 { margin: 0; font-size: 1.8em; }
.container { padding: 25px; max-width: 900px; margin: auto; }

/* 📑 كل سياسة */
.policy-item {
    background: #fff;
    border-radius: 8px;
    padding: 15px;
    margin: 10px 0;
    box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}
.policy-title {
    font-weight: bold;
    margin-bottom: 10px;
    font-size: 1.05em;
}
.policy-buttons {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}
.policy-buttons button,
.policy-buttons a {
    padding: 8px 12px;
    border-radius: 6px;
    border: none;
    font-size: 0.95em;
    cursor: pointer;
    color: #fff;
    transition: 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 5px;
    text-decoration: none;
}
.btn-view { background: #3498db; }
.btn-view:hover { background: #217dbb; }
.btn-download { background: #2ecc71; }
.btn-download:hover { background: #27ae60; }
.btn-print { background: #9b59b6; }
.btn-print:hover { background: #8e44ad; }

/* 📄 PDF Viewer */
#pdfViewer {
    width: 100%;
    height: 80vh;
    border: none;
    display: none;
    margin-top: 10px;
}
.pdf-toolbar {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 15px 0;
}
.pdf-toolbar button {
    background: #e67e22;
    color: white;
    border: none;
    padding: 10px 16px;
    border-radius: 6px;
    font-size: 0.95em;
    cursor: pointer;
}
.pdf-toolbar button:hover { background: #d35400; }
</style>
</head>
<body>
<header><h1>📚 السياسات والأدلة</h1></header>
<div class="container">
    <!-- ✅ زر الطباعة العام -->
    <div class="pdf-toolbar">
        <button id="btnGlobalPrint">🖨 طباعة مباشرة</button>
    </div>

    <!-- ✅ قائمة السياسات -->
    <div id="policiesContainer"></div>

    <!-- ✅ PDF Viewer -->
    <iframe id="pdfViewer"></iframe>
</div>

<script>
const studentPolicies = [
  { title: "📘 اللائحة السلوكية", filename: "Behaviour_Policy.pdf" },
  { title: "📗 الدليل الاجرائي لإدارة حضور وغياب الطلبة", filename: "Attendance_Policy.pdf" },
  { title: "📕 سياسة التقييم", filename: "Assessment_Policy.pdf" },
  { title: "📙 سياسة الوقاية من التنمر", filename: "Bullying_Prevention_Policy.pdf" },
  { title: "📒 سياسة حقوق الطفل", filename: "Child_Rights_Policy.pdf" },
  { title: "📓 قانون وديمة", filename: "Behaviour_Policy1.pdf" },
  { title: "📔 دليل الوقاية من التنمر", filename: "Bullying_Prevention_Policy.pdf" },
  { title: "📘 دليل ولي الأمر للوقاية من المخدرات", filename: "Drug_Prevention_Guide.pdf" },
  { title: "📗 دليل ولي الأمر للصحة النفسية", filename: "Mental_Health_Guide.pdf" },
  { title: "📕 دليل ولي الأمر للطفولة المبكرة", filename: "Parents’_Guide_to_Early_Childhood.pdf" },
  { title: "📙 سياسة الأمن الرقمي", filename: "Digital_Safety_Policy.pdf" }
];

const staffPolicies = [
  { title: "📘 الميثاق المهني والأخلاقي", filename: "Ethics_Charter_Policy.pdf" },
  { title: "📗 اللائحة السلوكية", filename: "Behaviour_Policy.pdf" },
  { title: "📕 الدليل الاجرائي لإدارة حضور وغياب الطلبة", filename: "Attendance_Policy.pdf" },
  { title: "📙 سياسة التقييم", filename: "Assessment_Policy.pdf" },
  { title: "📒 سياسة الوقاية من التنمر", filename: "Bullying_Prevention_Policy.pdf" },
  { title: "📓 سياسة حقوق الطفل", filename: "Child_Rights_Policy.pdf" },
  { title: "📔 قانون وديمة", filename: "Behaviour_Policy1.pdf" },
  { title: "📘 دليل الوقاية من التنمر", filename: "Bullying_Prevention_Policy.pdf" },
  { title: "📗 دليل ولي الأمر للوقاية من المخدرات", filename: "Drug_Prevention_Guide.pdf" },
  { title: "📕 دليل ولي الأمر للصحة النفسية", filename: "Mental_Health_Guide.pdf" },
  { title: "📙 دليل ولي الأمر للطفولة المبكرة", filename: "Parents’_Guide_to_Early_Childhood.pdf" },
  { title: "📒 سياسة الأمن الرقمي", filename: "Digital_Safety_Policy.pdf" }
];

let currentPdfFile = null;

// ✅ فتح PDF للعرض
function openPdfPolicy(filename) {
    if (!filename) return alert("❌ لم يتم تحديد الملف");
    currentPdfFile = filename;

    const isMobile = /Mobi|Android/i.test(navigator.userAgent);
    const pdfViewer = document.getElementById("pdfViewer");

    if (isMobile) {
        window.open(`/pdfjs/web/viewer.html?file=${encodeURIComponent("/pdfs/" + filename)}`, "_blank");
    } else {
        pdfViewer.src = `/pdfjs/web/viewer.html?file=${encodeURIComponent("/pdfs/" + filename)}`;
        pdfViewer.style.display = "block";
        pdfViewer.scrollIntoView({ behavior: "smooth" });
    }
}

// ✅ طباعة مباشرة
function printPdfDirect() {
    if (!currentPdfFile) return alert("❌ لم يتم اختيار ملف للطباعة");
    const printWindow = window.open(`/pdfs/${currentPdfFile}`, "_blank");
    if (printWindow) {
        printWindow.addEventListener("load", () => {
            printWindow.print();
        });
    }
}

// ✅ تحميل السياسات
function loadPolicies(role) {
    const container = document.getElementById("policiesContainer");
    container.innerHTML = "";

    const policies = role === "student" ? studentPolicies : staffPolicies;

    policies.forEach(item => {
        const div = document.createElement("div");
        div.className = "policy-item";

        const title = document.createElement("div");
        title.className = "policy-title";
        title.textContent = item.title;

        const btns = document.createElement("div");
        btns.className = "policy-buttons";

        const btnView = document.createElement("button");
        btnView.className = "btn-view";
        btnView.innerHTML = "👁 عرض";
        btnView.onclick = () => openPdfPolicy(item.filename);

        const btnDownload = document.createElement("a");
        btnDownload.className = "btn-download";
        btnDownload.href = `/pdfs/${item.filename}`;
        btnDownload.download = item.filename;
        btnDownload.innerHTML = "⬇ تحميل";

        const btnPrint = document.createElement("button");
        btnPrint.className = "btn-print";
        btnPrint.innerHTML = "🖨 طباعة";
        btnPrint.onclick = () => { currentPdfFile = item.filename; printPdfDirect(); };

        btns.appendChild(btnView);
        btns.appendChild(btnDownload);
        btns.appendChild(btnPrint);

        div.appendChild(title);
        div.appendChild(btns);
        container.appendChild(div);
    });
}

document.addEventListener("DOMContentLoaded", () => {
    const role = new URLSearchParams(window.location.search).get("role") || sessionStorage.getItem("role");
    if (role) loadPolicies(role);

    document.getElementById("btnGlobalPrint").onclick = printPdfDirect;
});
</script>
</body>
</html>
